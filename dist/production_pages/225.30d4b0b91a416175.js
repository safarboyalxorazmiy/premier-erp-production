"use strict";(self.webpackChunkproduction_pages=self.webpackChunkproduction_pages||[]).push([[225],{6225:(z,_,s)=>{s.r(_),s.d(_,{MetalsModule:()=>F});var u=s(9808),m=s(4054),c=s(5861),b=s(4327),e=s(7587),T=s(715),h=s(845),f=s(4851),y=s(9783),x=s(5315),g=s(2382);function Z(n,o){if(1&n){const t=e.EpF();e.ynx(0,30),e.TgZ(1,"button",31),e.NdJ("click",function(){const a=e.CHM(t).$implicit,l=e.oxw();return l.requestSerial(a),l.clicked=!0}),e._uU(2),e.qZA(),e.BQk()}if(2&n){const t=o.$implicit,r=e.oxw();e.xp6(1),e.Q6J("disabled",r.clicked),e.xp6(1),e.lnq("",t.name," ",": "," ",t.plan,"")}}function M(n,o){1&n&&(e.TgZ(0,"div",32),e._uU(1," Kunlik reja "),e.qZA())}function v(n,o){1&n&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Name "),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Comment "),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Plan "),e.qZA(),e.TgZ(7,"th"),e._uU(8,"GsCount "),e.qZA()())}function C(n,o){if(1&n&&(e.TgZ(0,"tr",33)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA()()),2&n){const t=o.$implicit;e.Q6J("pEditableRow",t),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.comment),e.xp6(2),e.Oqu(t.plan),e.xp6(2),e.Oqu(t.gscount)}}function k(n,o){1&n&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Serial"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Model"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Time"),e.qZA()())}function q(n,o){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA()()),2&n){const t=o.$implicit;e.xp6(2),e.Oqu(t.serial),e.xp6(2),e.Oqu(t.model),e.xp6(2),e.Oqu(t.time)}}function A(n,o){1&n&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Name"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Soni"),e.qZA()())}function S(n,o){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA()()),2&n){const t=o.$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.count)}}function O(n,o){1&n&&(e.TgZ(0,"div",34),e._uU(1,"Yuklanmoqda..."),e.qZA())}function P(n,o){1&n&&(e.TgZ(0,"div",34),e._uU(1," 3 kunda hech narsa chiqarilmagan "),e.qZA())}function U(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",40),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw(3).selectReprintGroup(a.key)}),e._uU(1),e.qZA()}if(2&n){const t=o.$implicit,r=e.oxw(3);e.ekj("active",r.selectedReprintGroup===t.key),e.xp6(1),e.AsE(" ",t.model," (",t.count,") ")}}function w(n,o){if(1&n&&(e.TgZ(0,"div",36)(1,"span",37),e._uU(2),e.qZA(),e.TgZ(3,"div",38),e.YNc(4,U,2,4,"button",39),e.qZA()()),2&n){const t=o.$implicit;e.xp6(2),e.Oqu(t.label),e.xp6(2),e.Q6J("ngForOf",t.groups)}}function D(n,o){1&n&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Serial"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Vaqt"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Qayta chiqarish"),e.qZA()())}function J(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td")(6,"button",42),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw(3).reprintSerial(a.serial)}),e.qZA()()()}if(2&n){const t=o.$implicit,r=e.oxw(3);e.xp6(2),e.Oqu(t.serial),e.xp6(2),e.Oqu(t.time),e.xp6(2),e.Q6J("disabled",r.reprintClicked)}}function Y(n,o){if(1&n&&(e.TgZ(0,"div")(1,"p-table",41),e.YNc(2,D,7,0,"ng-template",15),e.YNc(3,J,7,3,"ng-template",16),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("value",t.getSelectedSerials())("paginator",!0)("rows",10)("showCurrentPageReport",!0)}}function N(n,o){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,w,5,2,"div",35),e.YNc(2,Y,4,4,"div",29),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.reprintDays),e.xp6(1),e.Q6J("ngIf",t.selectedReprintGroup)}}const E=function(){return{width:"750px",maxHeight:"85vh"}},R=[{path:"",component:(()=>{class n{constructor(t,r,i){this.route=t,this.api=r,this.renderer=i,this.time=new Date,this.line=9,this.serial="",this.clicked=!1,this.added=!1,this.addedText="Kiritildi",this.someError=!1,this.errorText="",this.reprintDialogVisible=!1,this.reprintDays=[],this.reprintLoading=!1,this.reprintClicked=!1,this.selectedReprintGroup="",this.reprintSearchSerial=""}ngOnInit(){var t=this;return(0,c.Z)(function*(){t.id=t.route.snapshot.paramMap.get("model_id"),console.log(t),t.models=yield t.api.getModels();for(let i of t.models)i.id==t.id&&(t.selectedModel=i.name+" "+i.comment);let r={line:t.line};t.otherData=yield t.api.BackendRequest("","/production/plan/info"),t.lastProduct=yield t.api.getLast(r),t.count=yield t.api.getToday(r),t.byModel=yield t.api.getTodayByModels(r),t.rest=yield t.api.getSectorBalance(r),t.getPlan()})()}requestSerial(t){var r=this;return(0,c.Z)(function*(){r.clicked=!0,setTimeout(()=>{r.clicked=!1},3e3);let i={id:t.id};console.log(t);let a=yield r.api.MetallSerial(i);console.log("result: ",a),"ok"!=a.result?(r.someError=!0,r.added=!1,r.errorText=`${a.error}`):(r.someError=!1,r.errorText=""),r.getPlan()})()}getPlan(){var t=this;return(0,c.Z)(function*(){let r=yield t.api.BackendRequest("","/production/metals/plan/list");console.log(r),"ok"===r.result&&(t.plan=r.data)})()}getLabel(t){var r=this;return(0,c.Z)(function*(){let i=yield r.api.BackendRequest({id:t.model_id},"/production/metall/serial");"ok"==i.result||(r.errorText=i.error),r.getPlan()})()}change(){this.serial.includes("clear")&&(this.serial=""),this.serial.includes("refresh")&&location.reload(),15===this.serial.length&&(this.sendSerial=this.serial,this.serial="",this.submit())}submit(){var t=this;return(0,c.Z)(function*(){let r={serial:t.sendSerial,line:t.line},i=yield t.api.serialInput(r);if(t.serial="",console.log("result: ",i),"ok"!=i.result)return t.someError=!0,t.added=!1,void(t.errorText=`${i.error}`);t.someError=!1,t.errorText="";let a={line:t.line};t.lastProduct=yield t.api.getLast(a),t.count=yield t.api.getToday(a),t.byModel=yield t.api.getTodayByModels(a),t.rest=yield t.api.getSectorBalance(a),t.added=!0,setTimeout(()=>{t.added=!1},3e3)})()}openReprintDialog(){var t=this;return(0,c.Z)(function*(){t.reprintDialogVisible=!0,t.reprintLoading=!0,t.selectedReprintGroup="",t.reprintDays=[],t.reprintSearchSerial="";let r=yield t.api.getMetalsTodayPrinted();if("ok"===r.result){let i=r.data||[],a=t.formatDateDDMMYYYY(new Date),l={};for(let p of i){let d=p.date||a;l[d]||(l[d]={}),l[d][p.model]||(l[d][p.model]=[]),l[d][p.model].push(p)}t.reprintDays=Object.keys(l).map(p=>({date:p,label:p===a?"Bugun":t.formatDateLabel(p),groups:Object.keys(l[p]).map(d=>({model:d,key:p+"|"+d,count:l[p][d].length,serials:l[p][d].slice(0,50)}))}))}else t.reprintDays=[],t.someError=!0,t.errorText=r.error;t.reprintLoading=!1})()}formatDateDDMMYYYY(t){return String(t.getDate()).padStart(2,"0")+"."+String(t.getMonth()+1).padStart(2,"0")+"."+t.getFullYear()}formatDateLabel(t){let r=t.split(".");return 3!==r.length?t:r[0]+" "+({"01":"Yanvar","02":"Fevral","03":"Mart","04":"Aprel","05":"May","06":"Iyun","07":"Iyul","08":"Avgust","09":"Sentabr",10:"Oktabr",11:"Noyabr",12:"Dekabr"}[r[1]]||r[1])}selectReprintGroup(t){this.selectedReprintGroup=this.selectedReprintGroup===t?"":t}getSelectedSerials(){for(let t of this.reprintDays){let r=t.groups.find(i=>i.key===this.selectedReprintGroup);if(r)return r.serials}return[]}reprintSerial(t){var r=this;return(0,c.Z)(function*(){r.reprintClicked=!0;let i=yield r.api.metalsReprintSerial({serial:t});"ok"!==i.result?(r.someError=!0,r.added=!1,r.errorText=`${i.error}`):(r.someError=!1,r.errorText="",r.added=!0,r.addedText="Qayta chiqarildi",setTimeout(()=>{r.added=!1,r.addedText="Kiritildi"},3e3)),setTimeout(()=>{r.reprintClicked=!1},3e3)})()}reprintBySerial(){var t=this;return(0,c.Z)(function*(){if(!t.reprintSearchSerial||""===t.reprintSearchSerial.trim())return;t.reprintClicked=!0;let r=yield t.api.metalsReprintSerial({serial:t.reprintSearchSerial.trim()});"ok"!==r.result?(t.someError=!0,t.added=!1,t.errorText=`${r.error}`):(t.someError=!1,t.errorText="",t.added=!0,t.addedText="Qayta chiqarildi",t.reprintSearchSerial="",setTimeout(()=>{t.added=!1,t.addedText="Kiritildi"},3e3)),setTimeout(()=>{t.reprintClicked=!1},3e3)})()}exportExcel(){var t=this;return(0,c.Z)(function*(){t.metalToday=yield t.api.getMetalTodaySerial(),s.e(574).then(s.bind(s,574)).then(r=>{const a={Sheets:{data:r.utils.json_to_sheet(t.metalToday)},SheetNames:["data"]},l=r.write(a,{bookType:"xlsx",type:"array"});t.saveAsExcelFile(l,"metal")})})()}saveAsExcelFile(t,r){let i=(new Date).getFullYear(),a=(new Date).getMonth(),l=(new Date).getDay(),p=(new Date).getHours(),d=(new Date).getMinutes();const j=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});b.saveAs(j,r+`_export_${i}_${a}_${l}-${p}_${d}.xlsx`)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(m.gz),e.Y36(T.g),e.Y36(e.Qsj))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-metals"]],decls:46,vars:27,consts:[[2,"margin-top","10px"],[2,"margin-left","20px","color","red","text-align","center",3,"hidden"],[2,"margin-left","20px","color","green","text-align","center",3,"hidden"],[1,"d-flex","text-center"],[2,"padding-left","10px"],["type","button","pButton","","pRipple","","icon","pi pi-file-excel","pTooltip","XLS","tooltipPosition","bottom",1,"p-button-success","mr-2",3,"click"],["type","button","pButton","","pRipple","","icon","pi pi-refresh","pTooltip","Qayta chiqarish","tooltipPosition","bottom",1,"p-button-warning","mr-2",3,"click"],[1,"flex","flex-wrap","absolute","top-0","right-0","align-items-center","justify-content-right"],[2,"padding-right","100px"],[2,"color","red"],[2,"display","flex","flex-direction","row","flex-wrap","wrap","justify-content","flex-start"],["style","align-items: center;",4,"ngFor","ngForOf"],["id","dt","dataKey","id","editMode","row","responsiveLayout","scroll",3,"value"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[1,"card"],[1,"grid"],[1,"col"],["responsiveLayout","scroll",3,"value"],["header","Qayta chiqarish (3 kunlik)",3,"visible","modal","draggable","resizable","visibleChange"],[1,"reprint-search"],[1,"reprint-search-label"],[1,"reprint-search-row"],["type","text","placeholder","Serial raqamini kiriting...",1,"reprint-search-input",3,"ngModel","ngModelChange","keydown.enter"],["type","button",1,"reprint-btn-print",3,"disabled","click"],[1,"pi","pi-print"],["class","reprint-state-msg",4,"ngIf"],[4,"ngIf"],[2,"align-items","center"],["type","button","pButton","","pRipple","",1,"p-button-secondary",2,"flex","0 1 calc(33.3% - 32px)","margin-right","10px","margin-bottom","10px","padding","10px","font-size","larger","text-align","center","height","100px",3,"disabled","click"],[1,"flex","align-items-center","justify-content-between"],[3,"pEditableRow"],[1,"reprint-state-msg"],["class","reprint-day",4,"ngFor","ngForOf"],[1,"reprint-day"],[1,"reprint-day-label"],[1,"reprint-groups"],["class","reprint-group-btn",3,"active","click",4,"ngFor","ngForOf"],[1,"reprint-group-btn",3,"click"],["responsiveLayout","scroll","currentPageReportTemplate","{first} - {last} / {totalRecords}",3,"value","paginator","rows","showCurrentPageReport"],["type","button","pButton","","pRipple","","icon","pi pi-print",1,"reprint-serial-btn","p-button-sm",3,"disabled","click"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div")(2,"p",1),e._uU(3),e.qZA(),e.TgZ(4,"h1",2),e._uU(5),e.qZA()(),e.TgZ(6,"div",3)(7,"h2",4),e._uU(8),e.TgZ(9,"button",5),e.NdJ("click",function(){return r.exportExcel()}),e.qZA(),e.TgZ(10,"button",6),e.NdJ("click",function(){return r.openReprintDialog()}),e.qZA()()(),e.TgZ(11,"div",7)(12,"h1",8),e._uU(13),e.ALo(14,"date"),e.qZA()(),e.TgZ(15,"h1",9),e._uU(16),e.qZA(),e.TgZ(17,"div",10),e.YNc(18,Z,3,4,"ng-container",11),e.qZA(),e.TgZ(19,"p-table",12,13),e.YNc(21,M,2,0,"ng-template",14),e.YNc(22,v,9,0,"ng-template",15),e.YNc(23,C,9,5,"ng-template",16),e.qZA(),e.TgZ(24,"div",17)(25,"div",18)(26,"div",19)(27,"p-table",20),e.YNc(28,k,7,0,"ng-template",15),e.YNc(29,q,7,3,"ng-template",16),e.qZA()(),e.TgZ(30,"div",19)(31,"p-table",20),e.YNc(32,A,5,0,"ng-template",15),e.YNc(33,S,5,2,"ng-template",16),e.qZA()()()(),e.TgZ(34,"p-dialog",21),e.NdJ("visibleChange",function(a){return r.reprintDialogVisible=a}),e.TgZ(35,"div",22)(36,"label",23),e._uU(37,"Serial bo'yicha qidirish"),e.qZA(),e.TgZ(38,"div",24)(39,"input",25),e.NdJ("ngModelChange",function(a){return r.reprintSearchSerial=a})("keydown.enter",function(){return r.reprintBySerial()}),e.qZA(),e.TgZ(40,"button",26),e.NdJ("click",function(){return r.reprintBySerial()}),e._UZ(41,"i",27),e._uU(42," Chiqarish "),e.qZA()()(),e.YNc(43,O,2,0,"div",28),e.YNc(44,P,2,0,"div",28),e.YNc(45,N,3,2,"div",29),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("hidden",!r.someError),e.xp6(1),e.Oqu(r.errorText),e.xp6(1),e.Q6J("hidden",!r.added),e.xp6(1),e.Oqu(r.addedText),e.xp6(3),e.AsE("Bugun ishlab chiqarilgan maxsulot soni: ",null==r.count?null:r.count.smena1,"/",null==r.count?null:r.count.smena2," "),e.xp6(5),e.Oqu(e.xi3(14,23,r.time,"HH:mm:ss")),e.xp6(3),e.Oqu(r.errorText),e.xp6(2),e.Q6J("ngForOf",r.plan),e.xp6(1),e.Q6J("value",r.plan),e.xp6(8),e.Q6J("value",r.lastProduct),e.xp6(4),e.Q6J("value",r.byModel),e.xp6(3),e.Akn(e.DdM(26,E)),e.Q6J("visible",r.reprintDialogVisible)("modal",!0)("draggable",!1)("resizable",!1),e.xp6(5),e.Q6J("ngModel",r.reprintSearchSerial),e.xp6(1),e.Q6J("disabled",r.reprintClicked||!r.reprintSearchSerial),e.xp6(3),e.Q6J("ngIf",r.reprintLoading),e.xp6(1),e.Q6J("ngIf",!r.reprintLoading&&0===r.reprintDays.length),e.xp6(1),e.Q6J("ngIf",!r.reprintLoading&&r.reprintDays.length>0))},directives:[h.Hq,u.sg,f.iA,y.jx,f.D$,x.V,g.Fj,g.JJ,g.On,u.O5],pipes:[u.uU],styles:["[_nghost-%COMP%]     .p-dialog{border-radius:10px;overflow:hidden}[_nghost-%COMP%]     .p-dialog .p-dialog-header{padding:16px 20px;border-bottom:1px solid #eee}[_nghost-%COMP%]     .p-dialog .p-dialog-content{padding:16px 20px}[_nghost-%COMP%]     .p-dialog .p-button{box-shadow:none!important}[_nghost-%COMP%]     .p-dialog .p-datatable{box-shadow:none}[_nghost-%COMP%]     .p-dialog .p-paginator{border:none;padding:8px 0}.reprint-search[_ngcontent-%COMP%]{margin-bottom:16px;padding:14px 16px;background:#f5f5f5;border-radius:8px}.reprint-search-label[_ngcontent-%COMP%]{display:block;font-size:12px;font-weight:600;color:#999;margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px}.reprint-search-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.reprint-search-input[_ngcontent-%COMP%]{flex:1;padding:10px 14px;font-size:15px;border:1px solid #ddd;border-radius:6px;background:#fff;color:#333;outline:none;transition:border-color .2s}.reprint-search-input[_ngcontent-%COMP%]:focus{border-color:#999}.reprint-search-input[_ngcontent-%COMP%]::placeholder{color:#bbb}.reprint-btn-print[_ngcontent-%COMP%]{padding:10px 20px;font-size:14px;border-radius:6px;background:#222;border:none;color:#fff;white-space:nowrap;cursor:pointer;transition:background .2s}.reprint-btn-print[_ngcontent-%COMP%]:hover:not(:disabled){background:#444}.reprint-btn-print[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.reprint-state-msg[_ngcontent-%COMP%]{text-align:center;padding:24px 16px;color:#999;font-size:14px}.reprint-day[_ngcontent-%COMP%]{margin-bottom:14px}.reprint-day-label[_ngcontent-%COMP%]{display:inline-block;background:#eee;color:#333;padding:3px 10px;border-radius:4px;font-weight:600;font-size:13px;margin-bottom:6px}.reprint-groups[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}.reprint-group-btn[_ngcontent-%COMP%]{flex:0 1 calc(50% - 4px);padding:10px;font-size:14px;text-align:center;border-radius:6px;border:1px solid #ddd;background:#fff;color:#333;cursor:pointer;transition:all .15s}.reprint-group-btn[_ngcontent-%COMP%]:hover{background:#f5f5f5}.reprint-group-btn.active[_ngcontent-%COMP%]{background:#222;color:#fff;border-color:#222}.reprint-serial-btn[_ngcontent-%COMP%]{background:#222;border:none;border-radius:4px;color:#fff;cursor:pointer;transition:background .2s}.reprint-serial-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#444}.reprint-serial-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}"]}),n})()}];let Q=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[m.Bz.forChild(R)],m.Bz]}),n})();var B=s(1424);let F=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[u.ez,Q,g.u5,f.U$,h.hJ,x.S,B.j]]}),n})()}}]);