"use strict";(self.webpackChunkproduction_pages=self.webpackChunkproduction_pages||[]).push([[428],{2428:(Y,m,l)=>{l.r(m),l.d(m,{DoorsModule:()=>Q});var g=l(9808),_=l(4054),c=l(5861),e=l(7587),b=l(715),x=l(845),f=l(4851),y=l(9783),h=l(5315),u=l(2382);function C(n,o){1&n&&(e.TgZ(0,"div",23),e._uU(1," Kunlik reja "),e.qZA())}function T(n,o){1&n&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Name "),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Comment "),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Quantity "),e.qZA()())}function v(n,o){if(1&n&&(e.TgZ(0,"tr",24)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA()()),2&n){const t=o.$implicit;e.Q6J("pEditableRow",t),e.xp6(2),e.Oqu(t.model_name),e.xp6(2),e.Oqu(t.comment),e.xp6(2),e.Oqu(t.quantity)}}function Z(n,o){if(1&n){const t=e.EpF();e.ynx(0,25),e.TgZ(1,"button",26),e.NdJ("click",function(){const a=e.CHM(t).$implicit,p=e.oxw();return p.getLabel(a),p.clicked=!0}),e._uU(2),e.qZA(),e.BQk()}if(2&n){const t=o.$implicit,r=e.oxw();e.xp6(1),e.Q6J("disabled",r.clicked),e.xp6(1),e.lnq("",t.model_name," ",": "," ",t.quantity,"")}}function k(n,o){1&n&&(e.TgZ(0,"div",27),e._uU(1,"Yuklanmoqda..."),e.qZA())}function D(n,o){1&n&&(e.TgZ(0,"div",27),e._uU(1," 3 kunda hech narsa chiqarilmagan "),e.qZA())}function M(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",33),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw(3).selectReprintGroup(a.key)}),e._uU(1),e.qZA()}if(2&n){const t=o.$implicit,r=e.oxw(3);e.ekj("active",r.selectedReprintGroup===t.key),e.xp6(1),e.AsE(" ",t.model," (",t.count,") ")}}function O(n,o){if(1&n&&(e.TgZ(0,"div",29)(1,"span",30),e._uU(2),e.qZA(),e.TgZ(3,"div",31),e.YNc(4,M,2,4,"button",32),e.qZA()()),2&n){const t=o.$implicit;e.xp6(2),e.Oqu(t.label),e.xp6(2),e.Q6J("ngForOf",t.groups)}}function q(n,o){1&n&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Fre Serial"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Ref Serial"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Vaqt"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Qayta chiqarish"),e.qZA()())}function A(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td")(8,"button",35),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw(3).reprintSerial(a)}),e.qZA()()()}if(2&n){const t=o.$implicit,r=e.oxw(3);e.xp6(2),e.Oqu(t.fre_serial),e.xp6(2),e.Oqu(t.ref_serial),e.xp6(2),e.Oqu(t.time),e.xp6(2),e.Q6J("disabled",r.reprintClicked)}}function R(n,o){if(1&n&&(e.TgZ(0,"div")(1,"p-table",34),e.YNc(2,q,9,0,"ng-template",9),e.YNc(3,A,9,4,"ng-template",10),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("value",t.getSelectedSerials())("paginator",!0)("rows",10)("showCurrentPageReport",!0)}}function P(n,o){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,O,5,2,"div",28),e.YNc(2,R,4,4,"div",22),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.reprintDays),e.xp6(1),e.Q6J("ngIf",t.selectedReprintGroup)}}const w=function(){return{width:"750px",maxHeight:"85vh"}},S=[{path:"",component:(()=>{class n{constructor(t){this.api=t,this.clicked=!1,this.added=!1,this.addedText="Kiritildi",this.someError=!1,this.reprintDialogVisible=!1,this.reprintDays=[],this.reprintLoading=!1,this.reprintClicked=!1,this.selectedReprintGroup="",this.reprintSearchRef=""}ngOnInit(){this.getPlan()}getPlan(){var t=this;return(0,c.Z)(function*(){let r=yield t.api.BackendRequest("","/production/doors/plan/list");console.log(r),"ok"===r.result&&(t.plan=r.data)})()}getLabel(t){var r=this;return(0,c.Z)(function*(){let i=yield r.api.BackendRequest({id:t.model_id},"/production/doors/print");"ok"==i.result||(r.errorText=i.error),r.getPlan(),r.clicked=!0,setTimeout(()=>{r.clicked=!1},500)})()}openReprintDialog(){var t=this;return(0,c.Z)(function*(){t.reprintDialogVisible=!0,t.reprintLoading=!0,t.selectedReprintGroup="",t.reprintDays=[],t.reprintSearchRef="";let r=yield t.api.getDoorsTodayPrinted();if("ok"===r.result){let i=r.data||[],a=t.formatDateDDMMYYYY(new Date),p={};for(let s of i){let d=s.date||a;p[d]||(p[d]={}),p[d][s.model]||(p[d][s.model]=[]),p[d][s.model].push(s)}t.reprintDays=Object.keys(p).map(s=>({date:s,label:s===a?"Bugun":t.formatDateLabel(s),groups:Object.keys(p[s]).map(d=>({model:d,key:s+"|"+d,count:p[s][d].length,serials:p[s][d].slice(0,50)}))}))}else t.reprintDays=[],t.someError=!0,t.errorText=r.error;t.reprintLoading=!1})()}formatDateDDMMYYYY(t){return String(t.getDate()).padStart(2,"0")+"."+String(t.getMonth()+1).padStart(2,"0")+"."+t.getFullYear()}formatDateLabel(t){let r=t.split(".");return 3!==r.length?t:r[0]+" "+({"01":"Yanvar","02":"Fevral","03":"Mart","04":"Aprel","05":"May","06":"Iyun","07":"Iyul","08":"Avgust","09":"Sentabr",10:"Oktabr",11:"Noyabr",12:"Dekabr"}[r[1]]||r[1])}selectReprintGroup(t){this.selectedReprintGroup=this.selectedReprintGroup===t?"":t}getSelectedSerials(){for(let t of this.reprintDays){let r=t.groups.find(i=>i.key===this.selectedReprintGroup);if(r)return r.serials}return[]}reprintSerial(t){var r=this;return(0,c.Z)(function*(){r.reprintClicked=!0;let i=yield r.api.doorsReprintSerial({ref_serial:t.ref_serial});"ok"!==i.result?(r.someError=!0,r.added=!1,r.errorText=`${i.error}`):(r.someError=!1,r.errorText="",r.added=!0,r.addedText="Qayta chiqarildi",setTimeout(()=>{r.added=!1,r.addedText="Kiritildi"},3e3)),setTimeout(()=>{r.reprintClicked=!1},3e3)})()}reprintBySerial(){var t=this;return(0,c.Z)(function*(){if(!t.reprintSearchRef||""===t.reprintSearchRef.trim())return;t.reprintClicked=!0;let r=yield t.api.doorsReprintSerial({ref_serial:t.reprintSearchRef.trim()});"ok"!==r.result?(t.someError=!0,t.added=!1,t.errorText=`${r.error}`):(t.someError=!1,t.errorText="",t.added=!0,t.addedText="Qayta chiqarildi",t.reprintSearchRef="",setTimeout(()=>{t.added=!1,t.addedText="Kiritildi"},3e3)),setTimeout(()=>{t.reprintClicked=!1},3e3)})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(b.g))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-doors"]],decls:31,vars:19,consts:[[2,"margin-top","10px"],[2,"margin-left","20px","color","red","text-align","center",3,"hidden"],[2,"margin-left","20px","color","green","text-align","center",3,"hidden"],[1,"d-flex","text-center"],[2,"padding-left","10px"],["type","button","pButton","","pRipple","","icon","pi pi-refresh","pTooltip","Qayta chiqarish","tooltipPosition","bottom",1,"p-button-warning","mr-2",3,"click"],["id","dt","dataKey","id","editMode","row","responsiveLayout","scroll",3,"value"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[2,"color","red"],[2,"display","flex","flex-direction","row","flex-wrap","wrap","justify-content","flex-start"],["style","align-items: center;",4,"ngFor","ngForOf"],["header","Qayta chiqarish (3 kunlik)",3,"visible","modal","draggable","resizable","visibleChange"],[1,"reprint-search"],[1,"reprint-search-label"],[1,"reprint-search-row"],["type","text","placeholder","Ref serial raqamini kiriting...",1,"reprint-search-input",3,"ngModel","ngModelChange","keydown.enter"],["type","button",1,"reprint-btn-print",3,"disabled","click"],[1,"pi","pi-print"],["class","reprint-state-msg",4,"ngIf"],[4,"ngIf"],[1,"flex","align-items-center","justify-content-between"],[3,"pEditableRow"],[2,"align-items","center"],["type","button","pButton","","pRipple","",1,"p-button-secondary",2,"flex","0 1 calc(33.3% - 32px)","margin-right","10px","margin-bottom","10px","padding","10px","font-size","larger","text-align","center","height","100px",3,"disabled","click"],[1,"reprint-state-msg"],["class","reprint-day",4,"ngFor","ngForOf"],[1,"reprint-day"],[1,"reprint-day-label"],[1,"reprint-groups"],["class","reprint-group-btn",3,"active","click",4,"ngFor","ngForOf"],[1,"reprint-group-btn",3,"click"],["responsiveLayout","scroll","currentPageReportTemplate","{first} - {last} / {totalRecords}",3,"value","paginator","rows","showCurrentPageReport"],["type","button","pButton","","pRipple","","icon","pi pi-print",1,"reprint-serial-btn","p-button-sm",3,"disabled","click"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div")(2,"p",1),e._uU(3),e.qZA(),e.TgZ(4,"h1",2),e._uU(5),e.qZA()(),e.TgZ(6,"div",3)(7,"h2",4),e._uU(8,"Kunlik reja "),e.TgZ(9,"button",5),e.NdJ("click",function(){return r.openReprintDialog()}),e.qZA()()(),e.TgZ(10,"p-table",6,7),e.YNc(12,C,2,0,"ng-template",8),e.YNc(13,T,7,0,"ng-template",9),e.YNc(14,v,7,4,"ng-template",10),e.qZA(),e.TgZ(15,"h1",11),e._uU(16),e.qZA(),e.TgZ(17,"div",12),e.YNc(18,Z,3,4,"ng-container",13),e.qZA(),e.TgZ(19,"p-dialog",14),e.NdJ("visibleChange",function(a){return r.reprintDialogVisible=a}),e.TgZ(20,"div",15)(21,"label",16),e._uU(22,"Serial bo'yicha qidirish"),e.qZA(),e.TgZ(23,"div",17)(24,"input",18),e.NdJ("ngModelChange",function(a){return r.reprintSearchRef=a})("keydown.enter",function(){return r.reprintBySerial()}),e.qZA(),e.TgZ(25,"button",19),e.NdJ("click",function(){return r.reprintBySerial()}),e._UZ(26,"i",20),e._uU(27," Chiqarish "),e.qZA()()(),e.YNc(28,k,2,0,"div",21),e.YNc(29,D,2,0,"div",21),e.YNc(30,P,3,2,"div",22),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("hidden",!r.someError),e.xp6(1),e.Oqu(r.errorText),e.xp6(1),e.Q6J("hidden",!r.added),e.xp6(1),e.Oqu(r.addedText),e.xp6(5),e.Q6J("value",r.plan),e.xp6(6),e.Oqu(r.errorText),e.xp6(2),e.Q6J("ngForOf",r.plan),e.xp6(1),e.Akn(e.DdM(18,w)),e.Q6J("visible",r.reprintDialogVisible)("modal",!0)("draggable",!1)("resizable",!1),e.xp6(5),e.Q6J("ngModel",r.reprintSearchRef),e.xp6(1),e.Q6J("disabled",r.reprintClicked||!r.reprintSearchRef),e.xp6(3),e.Q6J("ngIf",r.reprintLoading),e.xp6(1),e.Q6J("ngIf",!r.reprintLoading&&0===r.reprintDays.length),e.xp6(1),e.Q6J("ngIf",!r.reprintLoading&&r.reprintDays.length>0))},directives:[x.Hq,f.iA,y.jx,f.D$,g.sg,h.V,u.Fj,u.JJ,u.On,g.O5],styles:["[_nghost-%COMP%]     .p-dialog{border-radius:10px;overflow:hidden}[_nghost-%COMP%]     .p-dialog .p-dialog-header{padding:16px 20px;border-bottom:1px solid #eee}[_nghost-%COMP%]     .p-dialog .p-dialog-content{padding:16px 20px}[_nghost-%COMP%]     .p-dialog .p-button{box-shadow:none!important}[_nghost-%COMP%]     .p-dialog .p-datatable{box-shadow:none}[_nghost-%COMP%]     .p-dialog .p-paginator{border:none;padding:8px 0}.reprint-search[_ngcontent-%COMP%]{margin-bottom:16px;padding:14px 16px;background:#f5f5f5;border-radius:8px}.reprint-search-label[_ngcontent-%COMP%]{display:block;font-size:12px;font-weight:600;color:#999;margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px}.reprint-search-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.reprint-search-inputs[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:10px}.reprint-search-input[_ngcontent-%COMP%]{flex:1;padding:10px 14px;font-size:15px;border:1px solid #ddd;border-radius:6px;background:#fff;color:#333;outline:none;transition:border-color .2s}.reprint-search-input[_ngcontent-%COMP%]:focus{border-color:#999}.reprint-search-input[_ngcontent-%COMP%]::placeholder{color:#bbb}.reprint-btn-print[_ngcontent-%COMP%]{padding:10px 20px;font-size:14px;border-radius:6px;background:#222;border:none;color:#fff;white-space:nowrap;cursor:pointer;transition:background .2s}.reprint-btn-print.full-width[_ngcontent-%COMP%]{width:100%}.reprint-btn-print[_ngcontent-%COMP%]:hover:not(:disabled){background:#444}.reprint-btn-print[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.reprint-state-msg[_ngcontent-%COMP%]{text-align:center;padding:24px 16px;color:#999;font-size:14px}.reprint-day[_ngcontent-%COMP%]{margin-bottom:14px}.reprint-day-label[_ngcontent-%COMP%]{display:inline-block;background:#eee;color:#333;padding:3px 10px;border-radius:4px;font-weight:600;font-size:13px;margin-bottom:6px}.reprint-groups[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}.reprint-group-btn[_ngcontent-%COMP%]{flex:0 1 calc(50% - 4px);padding:10px;font-size:14px;text-align:center;border-radius:6px;border:1px solid #ddd;background:#fff;color:#333;cursor:pointer;transition:all .15s}.reprint-group-btn[_ngcontent-%COMP%]:hover{background:#f5f5f5}.reprint-group-btn.active[_ngcontent-%COMP%]{background:#222;color:#fff;border-color:#222}.reprint-serial-btn[_ngcontent-%COMP%]{background:#222;border:none;border-radius:4px;color:#fff;cursor:pointer;transition:background .2s}.reprint-serial-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#444}.reprint-serial-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}"]}),n})()}];let J=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[_.Bz.forChild(S)],_.Bz]}),n})();var U=l(1424);let Q=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[g.ez,J,u.u5,f.U$,x.hJ,h.S,U.j]]}),n})()}}]);